<!DOCTYPE html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>

    <script>

        var one_rep_max = {
            'Squat': 176,
            'Bench': 148,
            'Deadlift': 236,
            'Press': 80
        };

        var workout_by_week = [
            [
                {
                    '%': .4,
                    'reps': 5
                },
                {
                    '%': .5,
                    'reps': 5
                },
                {
                    '%': .6,
                    'reps': 3
                },
                {
                    '%': .65,
                    'reps': 5
                },
                {
                    '%': .75,
                    'reps': 5
                },
                {
                    '%': .85,
                    'reps': 5
                },
                {
                    '%': .65,
                    'reps': 5
                }
            ],
            [
                {
                    '%': .4,
                    'reps': 5
                },
                {
                    '%': .5,
                    'reps': 5
                },
                {
                    '%': .6,
                    'reps': 3
                },
                {
                    '%': .7,
                    'reps': 3
                },
                {
                    '%': .8,
                    'reps': 3
                },
                {
                    '%': .9,
                    'reps': 3
                },
                {
                    '%': .7,
                    'reps': 5
                }
            ],
            [
                {
                    '%': .4,

                    'reps': 5
                },
                {
                    '%': .5,

                    'reps': 5
                },
                {
                    '%': .6,

                    'reps': 5
                },
                {
                    '%': .75,

                    'reps': 5
                },
                {
                    '%': .85,

                    'reps': 3
                },
                {
                    '%': .95,

                    'reps': 1
                },
                {
                    '%': .75,
                    'reps': 5
                }
            ],


        ];

        var exercise_by_day = [
            null,
            'Squat',
            'Bench',
            'Deadlift',
            'Press',
            'Bench',
            'Squat'
        ]

        var increment = 5;

        function amountTocoins(amount, coins) {
            if (amount <= 0) {
                return [];
            }
            else {
                if (amount >= coins[0]) {
                    left = (amount - coins[0]);
                    return [coins[0]].concat(amountTocoins(left, coins));
                }
                else {
                    coins.shift();
                    return amountTocoins(amount, coins);
                }
            }
        }

        function create_workout(workout, exercise) {
            if (exercise) {


                const body = document.body;

                var y = document.createElement("h3");
                var t = document.createTextNode(exercise + ' - ' + one_rep_max[exercise] + ' 1RM');
                body.appendChild(y).appendChild(t);


                const tbl = document.createElement('table');
                tbl.setAttribute('class', 'table');

                const dropset = workout[workout.length - 1]

                for (const element of workout) {
                    if (element !== dropset) {
                        const tr = tbl.insertRow();
                        const td = tr.insertCell();

                        var training_max = one_rep_max[exercise] * 0.9;
                        var weight = Math.ceil(element['%'] * training_max / increment) * increment;

                        td.appendChild(document.createTextNode(weight));


                        const reps = tr.insertCell();
                        reps.appendChild(document.createTextNode(element['reps']));

                        const weight_breakdown = tr.insertCell();
                        var split = weight - 45;
                        var rounded_split = Math.ceil(split / increment) * increment / 2;
                        var plates = amountTocoins(rounded_split, [45, 25, 10, 5, 2.5])
                        weight_breakdown.appendChild(document.createTextNode(plates.join(', ')));
                    }


                }

                const head = tbl.createTHead();
                const thead = head.insertRow();

                var header = ['lb', 'reps', 'plates']
                for (const header_element of header) {

                    th = thead.insertCell();
                    th.appendChild(document.createTextNode(header_element));
                    th.setAttribute('scope', 'col')
                }


                body.appendChild(tbl);

                var a = document.createElement("h6");
                var b = document.createTextNode('Dropset (x5)');
                body.appendChild(a).appendChild(b);



                const tbl2 = document.createElement('table');
                tbl2.setAttribute('class', 'table');


                for (let index = 0; index < 1; index++) {
                    const element = dropset

                    const tr = tbl2.insertRow();
                    const td = tr.insertCell();

                    var training_max = one_rep_max[exercise] * 0.9;
                    var weight = Math.ceil(element['%'] * training_max / increment) * increment;

                    td.appendChild(document.createTextNode(weight));


                    const reps = tr.insertCell();
                    reps.appendChild(document.createTextNode(element['reps']));

                    const weight_breakdown = tr.insertCell();
                    var split = weight - 45;
                    var rounded_split = Math.ceil(split / increment) * increment / 2;
                    var plates = amountTocoins(rounded_split, [45, 25, 10, 5, 2.5])
                    weight_breakdown.appendChild(document.createTextNode(plates.join(', ')));


                }
                const head2 = tbl2.createTHead();
                const thead2 = head2.insertRow();

                var header = ['lb', 'reps', 'plates']
                for (const header_element of header) {

                    th = thead2.insertCell();
                    th.appendChild(document.createTextNode(header_element));
                    th.setAttribute('scope', 'col')
                }



                body.appendChild(tbl2);

            }
        }

        function getWeekNumber(d) {
            // Copy date so don't modify original
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            // Set to nearest Thursday: current date + 4 - current day number
            // Make Sunday's day number 7
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            // Get first day of year
            var yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            // Calculate full weeks to nearest Thursday
            var weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            // Return array of year and week number
            return weekNo;
        }

        var date = new Date()
        var week = getWeekNumber(date);

        var week_in_cycle = week % 3;
        var day_of_week = 1 // date.getDay();

        console.log('Week in Cycle: ' + week_in_cycle)

        var workout = workout_by_week[week_in_cycle]
        var exercise = exercise_by_day[day_of_week]

        create_workout(workout, exercise);


        var clicks = 5;

        function onClick() {
            clicks -= 1;
            var button = document.getElementById("clicks");
            button.innerHTML = clicks + " Sets Remaining";
            if (clicks <= 0) {
                button.style.display = "none"
            }
        };

    </script>

    <button class="btn btn-primary btn-lg" type="button" sets="true" onClick="onClick()" id="clicks">5 Sets
        Remaining</button>


</body>
